{
  "format_info": {
    "format": "{{ format_type }}",
    "description": "{{ format_type | title }} format reports for system updates",
    "content_type": "{% if format_type == 'json' %}application/json{% elif format_type == 'html' %}text/html{% elif format_type == 'excel' %}application/vnd.openxmlformats-officedocument.spreadsheetml.sheet{% endif %}",
    "last_updated": "{{ ansible_date_time.iso8601 }}"
  },
  "endpoints": {
    "format_root": "/{{ format_type }}/",
    "latest": "/{{ format_type }}/latest/",
    "api_catalog": "/{{ format_type }}/api.json"
  },
  "available_timestamps": [
    {% for timestamp in format_directories %}
    {
      "timestamp": "{{ timestamp }}",
      "url": "/{{ format_type }}/{{ timestamp }}/",
      "formatted_date": "{{ timestamp | regex_replace('(\\d{4})(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{2})', '\\3/\\2/\\1 \\4:\\5:\\6') }}"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ],
  "total_archives": {{ format_directories | length }},
  "latest_timestamp": "{{ format_directories | first | default('N/A') }}",
  "oldest_timestamp": "{{ format_directories | last | default('N/A') }}",
  "quick_links": {
    "latest_reports": "/{{ format_type }}/latest/",
    {% if format_type == 'html' %}
    "latest_consolidated": "/{{ format_type }}/latest/consolidated_report.html",
    "latest_summary": "/{{ format_type }}/latest/email_summary.html"
    {% elif format_type == 'json' %}
    "latest_consolidated": "/{{ format_type }}/latest/consolidated_report.json",
    "latest_index": "/{{ format_type }}/latest/index.json"
    {% elif format_type == 'excel' %}
    "latest_consolidated": "/{{ format_type }}/latest/consolidated_report.xlsx"
    {% endif %}
  },
  "navigation": {
    "parent_api": "/api.json",
    "sibling_formats": {
      {% for fmt in report_formats %}
      {% if fmt != format_type %}
      "{{ fmt }}": "/{{ fmt }}/api.json"{% if not loop.last %},{% endif %}
      {% endif %}
      {% endfor %}
    }
  }
}